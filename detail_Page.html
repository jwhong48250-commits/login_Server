<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Page</title>
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f4f8; /* light cool gray */
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px 10px;
        min-height: 100vh;
      }

      h2 {
        color: #333;
        margin-bottom: 20px;
      }

      /* 상세 글 박스 */
      #Info {
        width: 100%;
        max-width: 600px;
      }

      #Info div {
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        padding: 25px;
        box-sizing: border-box;
      }

      #Info div strong {
        font-size: 18px;
        color: #1a202c;
      }

      #Info div p {
        font-size: 15px;
        color: #4a5568;
        margin: 10px 0 20px 0;
      }

      /* 버튼 스타일 */
      #Info div button {
        background-color: #63b3ed;
        color: #fff;
        font-size: 14px;
        font-weight: 500;
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-right: 10px;
        transition: background-color 0.2s, transform 0.1s;
      }

      #Info div button:hover {
        background-color: #4299e1;
        transform: translateY(-1px);
      }

      #Info div button:last-child {
        background-color: #fc8181; /* 삭제 버튼 빨간색 */
      }

      #Info div button:last-child:hover {
        background-color: #f56565;
      }
    </style>
    <script>
      function postPage() {
        window.location.href = "postpage.html";
      }
      // URL에서 id 가져오기
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get("id");
      const token = localStorage.getItem("token");

      // 글 데이터 로드
      function loaddata() {
        if (!postId) {
          alert("잘못된 접근입니다.");
          window.location.href = "postpage.html";
          return;
        }

        fetch(`http://127.0.0.1:8080/post/${postId}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
        })
          .then((res) => {
            if (!res.ok) throw new Error("글 데이터를 가져올 수 없습니다.");
            return res.json();
          })
          .then((data) => {
            // 글 내용 표시
            document.getElementById("Info").innerHTML = `
          <div>
            <strong>${data.name}</strong><br>
            <p>${data.text}</p>
            <button onclick="editPost()">수정</button>
            <button onclick="deletPost()">삭제</button>
          </div>
        `;
          })
          .catch((err) => console.error("로드 오류:", err));
      }

      // 수정 버튼 → edit_post.html로 이동
      function editPost() {
        window.location.href = `edit_post.html?id=${postId}`;
      }

      // 삭제 버튼
      function deletPost() {
        if (!confirm("정말 이 글을 삭제하시겠습니까?")) return;

        fetch(`http://127.0.0.1:8080/post/${postId}`, {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
        })
          .then((res) => {
            if (res.status === 403) {
              alert("권한이 없습니다.");
              throw new Error("권한 없음");
            }
            if (!res.ok) throw new Error("삭제 실패");
            return res.json();
          })
          .then((data) => {
            alert("삭제 완료!");
            window.location.href = "postpage.html"; // 삭제 후 리스트로
          })
          .catch((err) => console.error("삭제 오류:", err));
        postPage();
      }

      window.onload = loaddata;
    </script>
  </head>
  <body>
    <h2>상세페이지</h2>
    <div id="Info"></div>
  </body>
</html>
